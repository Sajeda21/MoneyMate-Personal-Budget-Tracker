<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>MoneyMate – Personal Budget Tracker</title>
    <link rel="stylesheet" href="/static/css/style.css" />
    <link rel="icon" href="/static/favicon.svg" type="image/svg+xml">
    <link rel="icon" href="/static/favicon.png" type="image/png">
    <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  </head>
  <body>
    <div class="container">
      <header style="display:flex; align-items:center; justify-content:space-between; gap:12px;">
        <div style="display:flex; align-items:center; gap:10px;">
          <div>
            <h1 style="margin-bottom:2px;">MoneyMate</h1>
            <p>Personal Budget Tracker</p>
          </div>
          <button id="demoBtn" class="ghost" title="Populate demo data">Run Demo</button>
        </div>
        <div id="profileCard" class="card" style="cursor:pointer; display:flex; align-items:center; gap:10px; padding:8px 12px;">
          <img id="profileAvatarThumb" class="avatar-thumb" src="" alt="avatar" style="width:36px;height:36px;border-radius:50%;object-fit:cover;background:#e5e7eb;" />
          <div style="line-height:1.1;">
            <div id="profileUsername" style="font-weight:600;">User</div>
            <div id="profileEmailSmall" class="meta"></div>
            <div style="display:flex; gap:8px;">
              <a id="editProfileLink" class="meta" style="text-decoration:none;">Edit Profile</a>
              <a id="headerLogoutLink" class="meta" style="text-decoration:none;">Logout</a>
            </div>
          </div>
        </div>
      </header>

      <section class="auth" id="authSection">
        <div class="card">
          <h2>Welcome</h2>
          <p>Please register or log in to view your personal budget dashboard.</p>
          <div class="add-transaction">
            <form id="registerForm" style="margin-bottom:12px;">
              <h3 style="margin:0 0 8px 0;">Register</h3>
              <div class="row">
                <label for="regEmail">Email</label>
                <input type="email" id="regEmail" required />
              </div>
              <div class="row">
                <label for="regPassword">Password</label>
                <input type="password" id="regPassword" required />
              </div>
              <button type="submit">Create Account</button>
              <p class="error" id="registerError" hidden></p>
            </form>

            <form id="loginForm">
              <h3 style="margin:0 0 8px 0;">Login</h3>
              <div class="row">
                <label for="loginEmail">Email</label>
                <input type="email" id="loginEmail" required />
              </div>
              <div class="row">
                <label for="loginPassword">Password</label>
                <input type="password" id="loginPassword" required />
              </div>
              <button type="submit">Login</button>
              <p class="error" id="loginError" hidden></p>
            </form>
          </div>
        </div>
      </section>

      <section id="walletPage" hidden>
        <div class="card">
          <div style="display:flex; align-items:center; justify-content:space-between;">
            <h2>Wallet</h2>
            <button id="walletBackBtn">Back</button>
          </div>
          <div style="margin-top:8px;" class="meta">Manage members and invites for your shared wallet.</div>
          <div style="display:grid; grid-template-columns: 1fr; gap:12px; margin-top:12px;">
            <div class="card" style="padding:12px;">
              <div style="display:flex; align-items:center; justify-content:space-between; gap:8px; flex-wrap:wrap;">
                <div>
                  <div class="meta">Wallet Name</div>
                  <div id="walletName" style="font-weight:600;">My Wallet</div>
                </div>
                <div style="display:flex; gap:8px; align-items:center;">
                  <input id="walletRenameInput" type="text" placeholder="Rename wallet" style="max-width:200px;" />
                  <button id="walletRenameSave" type="button" class="ghost">Save</button>
                  <button id="walletCreateBtn" type="button" class="ghost">Create Wallet</button>
                </div>
              </div>
            </div>
            <div class="card" style="padding:12px;">
              <h3 style="margin-top:0;">Invite Member</h3>
              <div class="add-transaction">
                <div class="row">
                  <label for="walletInviteEmail">Email</label>
                  <input type="email" id="walletInviteEmail" placeholder="teammate@example.com" />
                </div>
                <button id="walletInviteBtn" type="button">Send Invite</button>
              </div>
            </div>
            <div class="card" style="padding:12px;">
              <h3 style="margin-top:0;">Members</h3>
              <div id="walletMembersPage" style="display:flex; gap:8px; flex-wrap:wrap;"></div>
            </div>
          </div>
        </div>
      </section>

      

      <div id="appContent" hidden>
        
      <section class="balance" id="balanceSection">
        <div class="card">
          <h2>Total Balance</h2>
          <div class="balance-values">
            <div><span>Income:</span> <strong id="incomeValue">0</strong></div>
            <div><span>Expense:</span> <strong id="expenseValue">0</strong></div>
            <div class="total"><span>Balance:</span> <strong id="balanceValue">0</strong></div>
          </div>
        </div>
      </section>

      <section class="summary-and-filters">
        <div class="card" style="margin-bottom:12px;">
          <h2>Current Month Summary</h2>
          <div class="balance-values">
            <div><span>Income:</span> <strong id="monthIncome">0</strong></div>
            <div><span>Expense:</span> <strong id="monthExpense">0</strong></div>
            <div class="total"><span>Net:</span> <strong id="monthNet">0</strong></div>
          </div>
        </div>
        <div class="card">
          <h2>Filters</h2>
          <div class="add-transaction">
            <div class="row">
              <label for="filterCategory">Category</label>
              <select id="filterCategory">
                <option value="">All</option>
              </select>
            </div>
            <div class="row">
              <label for="filterStart">Start Date</label>
              <input type="datetime-local" id="filterStart" />
            </div>
            <div class="row">
              <label for="filterEnd">End Date</label>
              <input type="datetime-local" id="filterEnd" />
            </div>
            <button id="applyFilters">Apply Filters</button>
            <button id="clearFilters" style="margin-left:8px;">Clear</button>
            <button id="downloadCsv" style="float:right;">Download CSV</button>
          </div>
        </div>
      </section>

      <section class="add-transaction">
        <div class="card" style="margin-bottom:12px;">
          <h2>Add Income</h2>
          <form id="incomeForm">
            <div class="row">
              <label for="incomeCategory">Category</label>
              <input type="text" id="incomeCategory" placeholder="e.g., Salary, Bonus" required />
            </div>
            <div class="row">
              <label for="incomeAmount">Amount</label>
              <input type="number" id="incomeAmount" step="0.01" min="0" required />
            </div>
            <div class="row">
              <label for="incomeDate">Date</label>
              <input type="datetime-local" id="incomeDate" />
            </div>
            <button type="submit">Add Income</button>
            <p class="error" id="incomeError" hidden></p>
          </form>
        </div>

        <div class="card">
          <h2>Add Expense</h2>
          <form id="expenseForm">
            <div class="row">
              <label for="expenseCategory">Category</label>
              <input type="text" id="expenseCategory" placeholder="e.g., Groceries, Rent" required />
            </div>
            <div class="row">
              <label for="expenseAmount">Amount</label>
              <input type="number" id="expenseAmount" step="0.01" min="0" required />
            </div>
            <div class="row">
              <label for="expenseDate">Date</label>
              <input type="datetime-local" id="expenseDate" />
            </div>
            <button type="submit">Add Expense</button>
            <p class="error" id="expenseError" hidden></p>
          </form>
        </div>
      </section>

      <section class="transactions">
        <div class="card">
          <h2>Transactions</h2>
          <div id="transactionsList" class="transactions-list"></div>
        </div>
      </section>

      <section class="breakdown">
        <div class="card">
          <div style="display:flex; align-items:center; justify-content:space-between; gap:12px; flex-wrap:wrap;">
            <h2 style="margin:0;">Expense Breakdown by Category</h2>
            <div style="display:flex; align-items:center; gap:8px;">
              <button id="rangeWeek" class="ghost">This Week</button>
              <button id="rangeMonth" class="ghost">This Month</button>
              <button id="rangeYear" class="ghost">This Year</button>
              <span style="width:1px;height:20px;background:#e5e7eb;display:inline-block;margin:0 4px;"></span>
              <button id="chartPieBtn" class="ghost">Pie</button>
              <button id="chartBarBtn" class="ghost">Bar</button>
              <span style="width:1px;height:20px;background:#e5e7eb;display:inline-block;margin:0 4px;"></span>
              <button id="exportCsvBtn" class="ghost">Export CSV</button>
              <button id="exportPdfBtn" class="ghost">Export PDF</button>
            </div>
          </div>

          <div style="display:grid; grid-template-columns: minmax(220px, 420px) 1fr; gap:16px; align-items:start; margin-top:12px;">
            <div>
              <div style="padding:8px; background:#f8fafc; border-radius:12px;">
                <canvas id="expenseChart" height="140"></canvas>
              </div>
              <p id="expenseChartEmpty" class="meta" style="text-align:center; margin-top:8px;" hidden>
                No expense data yet. Add an expense to see the chart.
              </p>
            </div>
            <div>
              <div style="display:grid; grid-template-columns: repeat(3, 1fr); gap:8px;">
                <div class="stat">
                  <div class="meta">Total Spent</div>
                  <div id="sumTotal" style="font-weight:600;">0</div>
                </div>
                <div class="stat">
                  <div class="meta">Top Category</div>
                  <div id="sumTopCat" style="font-weight:600;">—</div>
                </div>
                <div class="stat">
                  <div class="meta">Avg per Category</div>
                  <div id="sumAvg" style="font-weight:600;">0</div>
                </div>
              </div>

              <div style="margin-top:10px; overflow:auto;">
                <table style="width:100%; border-collapse:separate; border-spacing:0 6px;">
                  <thead>
                    <tr class="meta">
                      <th style="text-align:left;">Category</th>
                      <th style="text-align:right;">Amount</th>
                      <th style="text-align:right;">% of total</th>
                    </tr>
                  </thead>
                  <tbody id="catTableBody"></tbody>
                </table>
              </div>

              <div style="margin-top:12px; display:grid; grid-template-columns: 1fr; gap:12px;">
                <div class="card" style="padding:12px;">
                  <div style="display:flex; align-items:center; justify-content:space-between; gap:8px; flex-wrap:wrap;">
                    <div>
                      <strong>Category Details</strong>
                      <span id="detailsCategory" class="meta">(click a slice/bar to focus)</span>
                    </div>
                    <div style="display:flex; gap:8px; align-items:center;">
                      <label for="budgetInput" class="meta">Monthly Budget</label>
                      <input id="budgetInput" type="number" step="0.01" placeholder="e.g. 500" style="max-width:140px;"/>
                      <span id="budgetVariance" class="meta"></span>
                    </div>
                  </div>
                  <div style="display:grid; grid-template-columns: minmax(220px, 420px) 1fr; gap:16px; margin-top:10px; align-items:start;">
                    <div style="padding:8px; background:#f8fafc; border-radius:12px;">
                      <canvas id="expenseTrendChart" height="120"></canvas>
                    </div>
                    <div style="overflow:auto; max-height:240px;">
                      <table style="width:100%; border-collapse:separate; border-spacing:0 6px;">
                        <thead>
                          <tr class="meta">
                            <th style="text-align:left;">Date</th>
                            <th style="text-align:left;">Category</th>
                            <th style="text-align:right;">Amount</th>
                          </tr>
                        </thead>
                        <tbody id="detailsTableBody"></tbody>
                      </table>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <section class="insights">
        <div class="card">
          <h2>Smart Insights</h2>
          <ul id="insightsList"></ul>
        </div>
      </section>

      <section class="collab-goals" id="collabGoals">
        <div class="card" style="margin-bottom:12px;">
          <div style="display:flex; align-items:center; justify-content:space-between;">
            <h2>Shared Wallets</h2>
            <button id="walletManageBtn" type="button">Manage Wallet</button>
          </div>
          <div class="add-transaction" style="margin-top:8px;">
            <div class="row">
              <label for="inviteEmail">Invite by Email</label>
              <input type="email" id="inviteEmail" placeholder="teammate@example.com" />
            </div>
            <button id="inviteBtn" type="button">Send Invite</button>
          </div>
          <div style="margin-top:10px; display:flex; gap:8px; flex-wrap:wrap;" id="walletMembers"></div>
          <p class="meta" style="margin-top:6px;">Invites are simulated locally for now; backend sync can be enabled next.</p>
        </div>

        <div class="card" style="margin-bottom:12px;">
          <h2>Goals & Achievements</h2>
          <form id="goalForm" class="add-transaction" style="margin-top:8px;">
            <div class="row">
              <label for="goalName">Goal</label>
              <input id="goalName" type="text" placeholder="e.g., Spend under $300 on Food" required />
            </div>
            <div class="row">
              <label for="goalTarget">Target ($)</label>
              <input id="goalTarget" type="number" step="0.01" min="0" required />
            </div>
            <div class="row">
              <label for="goalCategory">Category (optional)</label>
              <input id="goalCategory" type="text" placeholder="e.g., Food" />
            </div>
            <button type="submit">Add Goal</button>
          </form>
          <div id="goalsList" style="margin-top:10px; display:grid; gap:10px;"></div>
        </div>

        <div class="card" style="margin-bottom:12px;">
          <h2>Expense Heatmap</h2>
          <div style="padding:8px; background: var(--card-muted); border-radius:12px;">
            <canvas id="expenseHeatmap" height="180"></canvas>
          </div>
          <p class="meta" style="margin-top:6px;">Last 30 days expense intensity</p>
        </div>

        <div class="card">
          <h2>Mood & Money</h2>
          <form id="moodForm" class="add-transaction" style="margin-top:8px;">
            <div class="row">
              <label for="moodSelect">Mood</label>
              <select id="moodSelect">
                <option value="1">1 - Very Low</option>
                <option value="2">2</option>
                <option value="3" selected>3 - Neutral</option>
                <option value="4">4</option>
                <option value="5">5 - Very High</option>
              </select>
            </div>
            <div class="row">
              <label for="moodNote">Note</label>
              <input id="moodNote" type="text" placeholder="optional" />
            </div>
            <button type="submit">Save Mood</button>
          </form>
          <div style="padding:8px; background: var(--card-muted); border-radius:12px; margin-top:10px;">
            <canvas id="moodTrend" height="140"></canvas>
          </div>
          <ul id="moodInsights" style="margin-top:10px;"></ul>
        </div>
      </section>
      </div>

      <section id="profilePage" hidden>
        <div class="card">
          <div style="display:flex; align-items:center; justify-content:space-between;">
            <h2>Profile</h2>
            <button id="profileBackBtn">Back</button>
          </div>

          <div style="display:grid; grid-template-columns: 120px 1fr; gap:16px; align-items:start;">
            <div>
              <img id="profileAvatar" src="" alt="avatar" style="width:100px;height:100px;border-radius:50%;object-fit:cover;background:#e5e7eb;" />
              <form id="avatarForm" style="margin-top:8px;">
                <input type="file" id="avatarInput" accept="image/*" />
                <button type="submit" style="margin-top:6px;">Upload</button>
              </form>
            </div>
            <div>
              <form id="profileForm" class="add-transaction">
                <div class="row">
                  <label for="pfFullName">Full name</label>
                  <input id="pfFullName" type="text" />
                </div>
                <div class="row">
                  <label for="pfUsername">Username</label>
                  <input id="pfUsername" type="text" />
                </div>
                <div class="row">
                  <label for="pfEmail">Email</label>
                  <input id="pfEmail" type="email" />
                </div>
                <div class="row" style="display:grid; grid-template-columns:1fr 1fr; gap:12px;">
                  <div>
                    <label for="pfCurrentPassword">Current Password</label>
                    <input id="pfCurrentPassword" type="password" placeholder="••••••••" />
                  </div>
                  <div>
                    <label for="pfNewPassword">New Password</label>
                    <input id="pfNewPassword" type="password" placeholder="New password" />
                  </div>
                </div>
                <button type="submit">Save Changes</button>
                <p class="error" id="profileError" hidden></p>
                <p class="meta" id="profileSuccess" hidden></p>
              </form>
              <div style="margin-top:10px; display:flex; gap:12px; align-items:center; flex-wrap:wrap;">
                <div>
                  <div class="meta">Account Created</div>
                  <div id="accountCreated" style="font-weight:600;">—</div>
                </div>
                <div>
                  <div class="meta">This Month Expense</div>
                  <div id="profileMonthExpense" style="font-weight:600;">0</div>
                </div>
                <div>
                  <div class="meta">Active Goals</div>
                  <div id="profileActiveGoals" style="font-weight:600;">0</div>
                </div>
              </div>
              <div style="margin-top:12px;">
                <h3 style="margin:8px 0;">Achievements</h3>
                <div id="badgesWrap" style="display:flex; gap:8px; flex-wrap:wrap;"></div>
              </div>
              <div style="margin-top:12px;">
                <button id="deleteAccountBtn" class="ghost" style="background:#111827; border:1px solid var(--border);">Delete Account</button>
              </div>
            </div>
          </div>
        </div>
      </section>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <script src="/static/js/script.js?v=4"></script>
  </body>
</html>
